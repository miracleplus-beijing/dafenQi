<!-- 漫游页面 - 简约博客美学重设计 -->
<view class="browse-page">

  <!-- 加载指示器 -->
  <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}"
          class="podcast-loader">
      <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="加载中"></image>
  </view>
  <!-- 主要内容区域 -->
  <view wx:if="{{!loading && podcastList.length > 0}}">
    <swiper class="browse-swiper"
            vertical="true"
            indicator-dots="false"
            autoplay="{{false}}"
            interval="999999"
            circular="false"
            current="{{currentIndex}}"
            duration="300"
            easing-function="easeInOutCubic"
            bindchange="handleSwiperChange"
            bindtouchstart="handleTouchStart"
            bindtouchmove="handleTouchMove">

      <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">

        <!-- 内容展示区域 (60%) -->
        <view class="content-display">

          <!-- 播客封面 -->
          <view class="podcast-cover {{index === currentIndex && isPlaying ? 'playing' : ''}}">

            <view class="cover-image-container">
              <image wx:if="{{item.cover_url}}"
                     src="{{item.cover_url}}"
                     class="cover-image"
                     mode="aspectFill"
                     alt="{{item.title}}" />
              <view wx:else class="cover-placeholder">
                <view class="cover-icon">🎵</view>
                <view class="cover-title">{{item.title}}</view>
              </view>

              <!-- 暂停遮罩效果 -->
              <view wx:if="{{index === currentIndex && !isPlaying}}" class="pause-overlay" >
                <t-icon name="play" size="128rpx" class="pause-icon" />
              </view>
            </view>
            <view class="podcast-card">
            博客脚本占位符
            </view>

   

  

          </view>

          <!-- 标题区域 -->
          <view class="title-section">
            <text class="main-title">{{item.title}}</text>
            <text class="sub-title">{{item.channel_name || '达芬Qi说'}}</text>
          </view>

          <!-- 横向操作栏 -->
          <view class="horizontal-actions">
            <view class="horizontal-action-btn {{item.isFavorited ? 'favorited' : ''}}" bindtap="handleFavorite">
              <image src="{{item.isFavorited ? 'https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/collection_selected.svg' : 'https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/collection_unselected.svg'}}"
                     class="horizontal-action-icon" />
            </view>

            <view class="horizontal-action-btn" bindtap="handleOpenComments">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/comment_quote.svg"
                     class="horizontal-action-icon" />
            </view>

            <view class="horizontal-action-btn">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/share.svg"
                     class="horizontal-action-icon" />
            </view>
          </view>

          <!-- 内容摘要区域 (替代认知卡片) -->
          <view class="content-summary">
            <view class="summary-label">
              <text>内容摘要</text>
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/insight.svg"
                     class="summary-icon" />
            </view>
            <text class="summary-text">{{item.description || '这是一期精彩的播客内容，包含了丰富的知识点和深度思考。'}}</text>
          </view>
        </view>

        <!-- 播放控制区域 (40%) -->
        <view class="playback-section">

          <!-- 进度控制 -->
          <view class="progress-section">
            <view class="time-info">
              <text class="current-time">{{currentTimeFormatted}}</text>
              <text class="total-time">{{totalTimeFormatted}}</text>
            </view>

            <view class="progress-container">
              <t-slider
                value="{{currentProgress}}"
                min="{{0}}"
                max="{{100}}"
                step="{{0.1}}"
                theme="filled"
                color="#ed8936"
                track-color="#e2e8f0"
                class="custom-slider"
                bindchange="handleSliderChange"
                bindchanging="handleSliderChanging"
                bindtouchstart="handleSliderTouchStart"
                bindtouchend="handleSliderTouchEnd"
                show-value="{{false}}"
              />
            </view>
          </view>

          <!-- 播放控制按钮 -->
          <view class="playback-controls">
            <!-- 播放速度 -->
            <view class="control-btn" bindtap="handleSpeedChange">
              <text class="speed-display">{{playbackSpeed}}×</text>
            </view>

            <!-- 后退15秒 -->
            <view class="control-btn" bindtap="handleRewind">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/backward-15s.svg"
                     class="control-icon" />
            </view>
            <!-- 播放/暂停按钮 -->
            <view class="play-btn" bindtap="handlePlayPause">

              <t-icon wx:if="{{ isPlaying }}" size="80rpx" name="pause" class="play-icon"  data-name="pause" bind:click="onIconTap" />
              <t-icon wx:else name="play" size="80rpx" class="play-icon"  data-name="play" bind:click="onIconTap" />

            </view>

            <!-- 前进30秒 -->
            <view class="control-btn" bindtap="handleFastForward">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/forward-30s.svg"
                     class="control-icon" />

            </view>

            <!-- 更多操作 -->
            <view class="control-btn" bindtap="handleMore">
              <text class="more-icon">⋯</text>
            </view>
          </view>
        </view>

      </swiper-item>
    </swiper>
  </view>

  <!-- 加载指示器 -->
  <view wx:if="{{loading}}" class="loading-indicator">
    <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
    <text>加载中...</text>
  </view>

  <!-- 当没有数据时显示的内容 -->
  <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
    <text>暂无播客内容</text>
  </view>

  <!-- 自定义音频加载指示器 -->
  <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
    <view class="loading-overlay"></view>
    <view class="loading-content">
      <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="加载中"></image>
      <text class="loading-text">{{audioLoadingText}}</text>
    </view>
  </view>

  <!-- 评论弹窗 -->
  <view class="comment-popup {{showCommentPopup ? 'show' : ''}}" catchtouchmove="preventScroll">
    <view class="popup-mask" bindtap="handleCloseComments"></view>
    <view class="popup-content">
      <view class="popup-header">
        <text class="popup-title">评论</text>
        <view class="popup-close" bindtap="handleCloseComments">
          <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/close.svg"
                 class="close-icon" />
        </view>
      </view>

      <!-- 评论列表 -->
      <scroll-view class="comment-list" scroll-y>
        <view wx:for="{{commentList}}" wx:key="id" class="comment-item">
          <image src="{{item.user_avatar}}" class="comment-avatar" />
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.user_nickname}}</text>
              <text class="comment-time">{{item.timestamp_formatted}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
            <view class="comment-actions">
              <view class="comment-action-btn" bindtap="handleReplyComment" data-comment-id="{{item.id}}">
                <text>回复</text>
              </view>
              <view class="comment-action-btn like-btn {{item.isLiked ? 'liked' : ''}}"
                    bindtap="handleLikeComment"
                    data-comment-id="{{item.id}}">
                <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/like-small.svg"
                       class="like-icon" />
                <text>{{item.like_count > 0 ? item.like_count : ''}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- 空评论提示 -->
        <view wx:if="{{commentList.length === 0}}" class="comment-empty">
          <text>还没有评论，来抢沙发吧~</text>
        </view>
      </scroll-view>

      <!-- 评论输入框 -->
      <view class="comment-input-wrapper">
        <input
          class="comment-input"
          placeholder="{{replyingToCommentId ? '回复评论...' : '发表评论...'}}"
          value="{{commentInputText}}"
          bindinput="handleCommentInput"
          confirm-type="send"
          bindconfirm="handleSendComment" />
        <view class="send-btn {{commentInputText.length > 0 ? 'active' : ''}}" bindtap="handleSendComment">
          <text>发送</text>
        </view>
      </view>
    </view>
  </view>

  <t-toast id="t-toast" />

</view>

