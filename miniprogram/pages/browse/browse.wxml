<!-- Êº´Ê∏∏È°µÈù¢ -->
<view class="browse-page">
  <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
  <view wx:if="{{!loading && podcastList.length > 0}}">
    <swiper class="browse-swiper" 
            vertical="true" 
            indicator-dots="false"
            indicator-color="rgba(0,0,0,0)"
            indicator-active-color="rgba(0,0,0,0)" 
            autoplay="{{false}}"
            interval="999999"
            circular="false"
            current="{{currentIndex}}"
            duration="300"
            easing-function="easeInOutCubic"
            bindchange="handleSwiperChange"
            bindtouchstart="handleTouchStart"
            bindtouchmove="handleTouchMove">
  <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">
    <!-- Êí≠ÂÆ¢Â∞ÅÈù¢ -->
    <view class="podcast-cover">
      <image wx:if="{{item.cover_url}}" 
             src="{{item.cover_url}}" 
             class="cover-image" 
             mode="aspectFill" 
             alt="{{item.title}}" />
      <view wx:else class="cover-placeholder">
        <view class="cover-icon">üéµ</view>
        <view class="cover-title">{{item.title}}</view>
      </view>
      <!-- Âä†ËΩΩÊåáÁ§∫Âô® - Âè™Âú®Èü≥È¢ëÂä†ËΩΩÊó∂ÊòæÁ§∫ -->
      <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}" 
            class="podcast-loader">
        <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="Âä†ËΩΩ‰∏≠"></image>
      </view>
    </view>

    <!-- Êí≠ÂÆ¢‰ø°ÊÅØ -->
    <view class="podcast-info">
      <view class="podcast-title-container">
        <view class="title-scroll-wrapper {{item.title.length > 12 ? 'scrolling' : ''}}" 
              data-title="{{item.title}}" 
              style="{{item.title.length > 12 ? 'animation-duration: ' + (item.title.length > 20 ? '5s' : item.title.length > 16 ? '4s' : item.title.length > 12 ? '3.5s' : '3s') : ''}}">
          <view class="title-item">{{item.title}}</view>
          <view class="title-item" wx:if="{{item.title.length > 12}}">{{item.title}}</view>
        </view>
      </view>
      <view class="podcast-channel" bindtap="handleChannelClick">{{item.channel_name}}</view>
    </view>

    <!-- ‰∫§‰∫íÊåâÈíÆÂå∫Âüü -->
    <view class="action-buttons">
      <view class="action-btn" bindtap="handleThumbsUp">
        <image src="{{item.isThumbsUp ? cdnImages.thumbsUpActiveIcon : cdnImages.thumbsUpIcon}}" 
               alt="ÁÇπËµû" class="icon"></image>
      </view>
      <view class="action-btn" bindtap="handleLike">
        <image src="{{item.isLiked ? cdnImages.likeActiveIcon : cdnImages.likeIcon}}" 
               alt="ÂñúÊ¨¢" class="icon"></image>
      </view>
      <view class="action-btn" bindtap="handleFavorite">
        <image src="{{item.isFavorited ? cdnImages.favoriteActiveIcon : cdnImages.favoriteIcon}}" 
               alt="Êî∂Ëóè" class="icon"></image>
      </view>
    </view>

    <!-- Êô∫ËÉΩÂàÜÂùóÁºìÂÜ≤ËøõÂ∫¶Êù° -->
    <view class="progress-container">
      <view class="progress-time-info">
        <text class="current-time">{{currentTimeFormatted}}</text>
        <!-- ÁΩëÁªúÁä∂ÊÄÅÊåáÁ§∫Âô® -->
        <view class="network-indicator {{networkStatus.isSlowNetwork ? 'slow' : 'fast'}}">
        </view>
        <text class="total-time">{{totalTimeFormatted}}</text>
      </view>
      
      <view class="progress-bar" bindtap="handleProgressClick">
        <!-- ËÉåÊôØËΩ®ÈÅì -->
        <view class="progress-track"></view>
        
        <!-- ÂàÜÂùóÁºìÂÜ≤ÊòæÁ§∫Â±Ç -->
        <view class="chunk-buffer-layer">
          <view wx:for="{{chunkDistribution}}" wx:key="index" 
                class="chunk-segment {{item.cached ? 'cached' : ''}} {{item.loading ? 'loading' : ''}}"
                style="left: {{item.left}}%; width: {{item.width}}%;">
          </view>
        </view>
        
        <!-- ‰º†ÁªüÁºìÂÜ≤ËøõÂ∫¶Êù°(‰Ωú‰∏∫Â§áÈÄâÊòæÁ§∫) -->
        <view class="progress-buffer {{chunkDistribution.length > 0 ? 'hidden' : ''}}" 
              style="width: {{bufferProgress}}%"></view>
        
        <!-- ÂΩìÂâçÊí≠ÊîæËøõÂ∫¶Êù° -->
        <view class="progress-fill" style="width: {{currentProgress}}%"></view>
        
        <!-- ÊãñÊãΩÊâãÊüÑ -->
        <view class="progress-thumb {{isDraggingThumb ? 'dragging' : ''}}" 
              style="left: {{currentProgress}}%" 
              catchtouchstart="handleThumbTouchStart"
              catchtouchmove="handleThumbMove"
              catchtouchend="handleThumbEnd">
        </view>
      </view>
    </view>

    <!-- Êí≠ÊîæÊéßÂà∂ -->
    <view class="playback-controls">
      <!-- ÂàÜ‰∫´ÊåâÈíÆ -->
      <view class="control-btn" bindtap="handleShare">
        <image src="{{cdnImages.shareIcon}}" alt="ÂàÜ‰∫´" class="icon"></image>
      </view>

      <!-- ÂêéÈÄÄ15Áßí -->
      <view class="control-btn" bindtap="handleRewind">
        <image src="{{cdnImages.rewindIcon}}" alt="ÂêéÈÄÄ15Áßí" class="icon"></image>
      </view>

      <!-- Êí≠Êîæ/ÊöÇÂÅúÊåâÈíÆ -->
      <view class="play-pause-btn" bindtap="handlePlayPause">
        <image src="{{isPlaying ? cdnImages.pauseIcon : cdnImages.playIcon}}" 
               alt="{{isPlaying ? 'ÊöÇÂÅú' : 'Êí≠Êîæ'}}" class="play-pause-icon"></image>
      </view>

      <!-- ÂâçËøõ30Áßí -->
      <view class="control-btn" bindtap="handleFastForward">
        <image src="{{cdnImages.forwardIcon}}" alt="ÂâçËøõ30Áßí" class="icon"></image>
      </view>

      <!-- ËÆ§Áü•ÊèêÂèñÊåâÈíÆ -->
      <view class="control-btn" bindtap="handleInsight">
        <image src="{{cdnImages.insightIcon}}" alt="ËÆ§Áü•ÊèêÂèñ" class="icon"></image>
      </view>
    </view>

    <!-- Êõ¥Â§öÊìç‰ΩúÊåâÈíÆ -->
    <view class="more-actions">
      <view class="more-btn" bindtap="handleMore">
        <text>‚ãØ</text>
      </view>
    </view>
    </swiper-item>
    </swiper>
  </view>

  <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
  <view wx:if="{{loading}}" class="loading-indicator">
    <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
    <text>Âä†ËΩΩ‰∏≠...</text>
  </view>

  <!-- ÂΩìÊ≤°ÊúâÊï∞ÊçÆÊó∂ÊòæÁ§∫ÁöÑÂÜÖÂÆπ -->
  <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
    <text>ÊöÇÊó†Êí≠ÂÆ¢ÂÜÖÂÆπ</text>
  </view>

  <!-- Ëá™ÂÆö‰πâÈü≥È¢ëÂä†ËΩΩÊåáÁ§∫Âô® -->
  <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
    <view class="loading-overlay"></view>
    <view class="loading-content">
      <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="Âä†ËΩΩ‰∏≠"></image>
      <text class="loading-text">{{audioLoadingText}}</text>
    </view>
  </view>

  <!-- ËÆ§Áü•ÊèêÂèñÂºπÁ™ó -->
  <view wx:if="{{insightVisible}}" class="insight-popup {{insightFullScreen ? 'fullscreen' : ''}}" 
        catchtouchmove="preventScroll">
    <!-- ÈÅÆÁΩ©Â±Ç -->
    <view class="insight-mask" bindtap="handleInsightClose"></view>
    
    <!-- ÂºπÁ™óÂÜÖÂÆπÂÆπÂô® -->
    <view class="insight-container {{insightFullScreen ? 'fullscreen' : ''}}" 
          style="transform: translateY({{insightTranslateY}}px);"
          catchtouchmove="preventScroll">
      
      <!-- ÊãñÊãΩÊåáÁ§∫Êù°ÂíåÂ§¥ÈÉ® - Ë¥üË¥£ÂÖ®Â±èÂàáÊç¢ÊâãÂäø -->
      <view class="insight-header"
            catchtouchstart="handleDragStart"
            catchtouchmove="handleDragMove"
            catchtouchend="handleDragEnd">
        <view class="drag-indicator"></view>
        <view class="insight-title-bar">
          <text class="insight-title">ËÆ§Áü•ÊèêÂèñ</text>
        </view>
      </view>
      
      <!-- ÊªöÂä®ÂÜÖÂÆπÂå∫Âüü - Ë¥üË¥£ÂÖ≥Èó≠ÊâãÂäø -->
      <scroll-view class="insight-content" 
                   scroll-y="{{true}}"
                   enable-flex="{{true}}"
                   catchtouchstart="handleContentTouchStart"
                   catchtouchmove="handleContentTouchMove" 
                   catchtouchend="handleContentTouchEnd">
        <!-- ÂÜÖÂÆπÂåÖË£ÖÂÆπÂô® -->
        <view class="insight-content-wrapper">
        <!-- Êí≠ÂÆ¢Âü∫Êú¨‰ø°ÊÅØ -->
        <view class="insight-podcast-info">
          <text class="podcast-title-insight">{{podcastList[currentIndex].title}}</text>
          <text class="podcast-channel-insight">{{podcastList[currentIndex].channel_name || 'Â•áÁª©ÂâçÊ≤ø‰ø°Âè∑'}}</text>
        </view>
        
        <!-- InsightÂÜÖÂÆπÂå∫Âüü -->
        <view wx:if="{{currentInsightData}}" class="insight-main-content">
          <!-- Ê†∏ÂøÉÊ¥ûÂØüÊªëÂä®Âç°Áâá -->
          <view class="insight-section">
            <view class="section-title">
              <text class="title-icon">üí°</text>
              <text class="title-text">Ê†∏ÂøÉÊ¥ûÂØü</text>
              <text class="insight-counter" wx:if="{{insightsList.length > 1}}">{{currentInsightIndex + 1}}/{{insightsList.length}}</text>
            </view>
            
            <!-- ÊªëÂä®Âç°ÁâáÂÆπÂô® -->
            <view class="insight-slider-container" wx:if="{{insightsList.length > 0}}">
              <swiper class="insight-swiper" 
                      indicator-dots="{{false}}" 
                      autoplay="{{false}}" 
                      circular="{{false}}" 
                      vertical="{{false}}"
                      current="{{currentInsightIndex}}"
                      bindchange="handleInsightSlideChange">
                <swiper-item wx:for="{{insightsList}}" wx:key="id" class="insight-slide-item">
                  <view class="insight-slide-card">
                    <view class="insight-slide-header">
                      <text class="insight-slide-title">{{item.summary}}</text>
                    </view>
                    <view class="insight-slide-content">
                      <text class="insight-slide-text">{{item.detailed_content}}</text>
                    </view>
                  </view>
                </swiper-item>
              </swiper>
              
              <!-- ÊªëÂä®ÊåáÁ§∫Âô® -->
              <view class="insight-slider-dots" wx:if="{{insightsList.length > 1}}">
                <view wx:for="{{insightsList}}" wx:key="id" 
                      class="insight-dot {{index === currentInsightIndex ? 'active' : ''}}"
                      bindtap="handleInsightDotClick"
                      data-index="{{index}}">
                </view>
              </view>
            </view>
            
            <!-- Êó†Êï∞ÊçÆÊó∂ÊòæÁ§∫ÈªòËÆ§ÂÜÖÂÆπ -->
            <view class="insight-card-outer" wx:elif="{{currentInsightData}}">
              <view class="insight-card-inner">
                <text class="summary-text">{{currentInsightData.summary}}</text>
              </view>
            </view>
          </view>
          
          <!-- ËØ¶ÁªÜÂÜÖÂÆπ -->
          <view wx:if="{{currentInsightData.detailed_content}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">üìÑ</text>
              <text class="title-text">ËØ¶ÁªÜÂàÜÊûê</text>
            </view>
            <view class="detailed-content">
              <text class="detailed-text">{{currentInsightData.detailed_content}}</text>
            </view>
          </view>
          
          <!-- ÂÖ≥ÈîÆËØçÊ†áÁ≠æ -->
          <view wx:if="{{currentInsightData.keywords && currentInsightData.keywords.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">üè∑Ô∏è</text>
              <text class="title-text">ÂÖ≥ÈîÆËØç</text>
            </view>
            <view class="keywords-container">
              <view wx:for="{{currentInsightData.keywords}}" wx:key="*this" class="keyword-tag">
                <text class="keyword-text">{{item}}</text>
              </view>
            </view>
          </view>
          
          <!-- Áõ∏ÂÖ≥ËÆ∫Êñá -->
          <view wx:if="{{currentInsightData.related_papers && currentInsightData.related_papers.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">üìö</text>
              <text class="title-text">Áõ∏ÂÖ≥ËÆ∫Êñá</text>
            </view>
            <view class="related-papers">
              <view wx:for="{{currentInsightData.related_papers}}" wx:key="title" class="paper-item">
                <text class="paper-title">{{item.title}}</text>
                <text class="paper-authors">{{item.authors.join(', ')}}</text>
              </view>
            </view>
          </view>
          
          <!-- Áõ∏ÂÖ≥‰ΩúËÄÖ -->
          <view wx:if="{{currentInsightData.related_authors && currentInsightData.related_authors.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">üë•</text>
              <text class="title-text">Áõ∏ÂÖ≥‰ΩúËÄÖ</text>
            </view>
            <view class="related-authors">
              <view wx:for="{{currentInsightData.related_authors}}" wx:key="name" class="author-item">
                <text class="author-name">{{item.name}}</text>
                <text class="author-institution">{{item.institution}}</text>
              </view>
            </view>
          </view>
          
          <!-- ‰∫íÂä®Âå∫Âüü -->
          <view class="insight-actions">
            <view class="action-item" bindtap="handleInsightLike">
              <image src="{{currentInsightData.isLiked ? cdnImages.likeActiveIcon : cdnImages.likeIcon}}" 
                     class="action-icon-image" alt="ÁÇπËµû"></image>
              <text class="action-count">{{currentInsightData.like_count || 0}}</text>
            </view>
            <view class="action-item" bindtap="handleInsightBookmark">
              <image src="{{cdnImages.favoriteIcon}}" class="action-icon-image" alt="Êî∂Ëóè"></image>
              <text class="action-text">Êî∂Ëóè</text>
            </view>
            <view class="action-item" bindtap="handleInsightShare">
              <image src="{{cdnImages.shareGrayIcon}}" class="action-icon-image" alt="ÂàÜ‰∫´"></image>
              <text class="action-text">ÂàÜ‰∫´</text>
            </view>
          </view>
        </view>
        
        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
        <view wx:if="{{insightLoading}}" class="insight-loading">
          <image src="{{cdnImages.loadingIcon}}" class="loading-icon-small"></image>
          <text class="loading-text-small">Ê≠£Âú®Âä†ËΩΩËÆ§Áü•ÊèêÂèñ...</text>
        </view>
        
        <!-- ÈîôËØØÁä∂ÊÄÅ -->
        <view wx:if="{{insightError}}" class="insight-error">
          <text class="error-icon">‚ö†Ô∏è</text>
          <text class="error-text">{{insightError}}</text>
          <view class="retry-btn" bindtap="handleInsightRetry">
            <text>ÈáçËØï</text>
          </view>
        </view>
        </view> <!-- ÁªìÊùü insight-content-wrapper -->
      </scroll-view>
    </view>
  </view>
</view>