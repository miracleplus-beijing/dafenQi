<!-- æ¼«æ¸¸é¡µé¢ -->
<view class="browse-page">
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view wx:if="{{!loading && podcastList.length > 0}}">
    <swiper class="browse-swiper" 
            vertical="true" 
            indicator-dots="false"
            indicator-color="rgba(0,0,0,0)"
            indicator-active-color="rgba(0,0,0,0)" 
            autoplay="{{false}}"
            interval="999999"
            circular="false"
            current="{{currentIndex}}"
            duration="300"
            easing-function="easeInOutCubic"
            bindchange="handleSwiperChange"
            bindtouchstart="handleTouchStart"
            bindtouchmove="handleTouchMove">
  <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">
    <!-- æ’­å®¢å°é¢ -->
    <view class="podcast-cover">
      <view class="cover-placeholder">
        <view class="cover-icon">ğŸµ</view>
        <view class="cover-title">{{item.title}}</view>
      </view>
      <!-- åŠ è½½æŒ‡ç¤ºå™¨ - åªåœ¨éŸ³é¢‘åŠ è½½æ—¶æ˜¾ç¤º -->
      <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}" 
            class="podcast-loader">
        <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="åŠ è½½ä¸­"></image>
      </view>
    </view>

    <!-- æ’­å®¢ä¿¡æ¯ -->
    <view class="podcast-info">
      <view class="podcast-title">{{item.title}}</view>
      <view class="podcast-channel" bindtap="handleChannelClick">{{item.channel_name || 'å¥‡ç»©å‰æ²¿ä¿¡å·'}}</view>
    </view>

    <!-- äº¤äº’æŒ‰é’®åŒºåŸŸ -->
    <view class="action-buttons">
      <view class="action-btn" bindtap="handleThumbsUp">
        <image src="{{item.isThumbsUp ? cdnImages.thumbsUpActiveIcon : cdnImages.thumbsUpIcon}}" 
               alt="ç‚¹èµ" class="icon"></image>
      </view>
      <view class="action-btn" bindtap="handleLike">
        <image src="{{item.isLiked ? cdnImages.likeActiveIcon : cdnImages.likeIcon}}" 
               alt="å–œæ¬¢" class="icon"></image>
      </view>
      <view class="action-btn" bindtap="handleFavorite">
        <image src="{{item.isFavorited ? cdnImages.favoriteActiveIcon : cdnImages.favoriteIcon}}" 
               alt="æ”¶è—" class="icon"></image>
      </view>
    </view>

    <!-- progress-bar -->
    <view class="progress-container">
      <view class="progress-time-info">
        <text class="current-time">{{currentTimeFormatted}}</text>
        <text class="total-time">{{totalTimeFormatted}}</text>
      </view>
      <view class="progress-bar" bindtap="handleProgressClick">
        <!-- é¢„åŠ è½½ç°åº¦æ¡ï¼ˆç¼“å†²è¿›åº¦ï¼‰ -->
        <view class="progress-buffer" style="width: {{bufferProgress}}%"></view>
        <!-- æ’­æ”¾è¿›åº¦æ¡ -->
        <view class="progress-fill" style="width: {{currentProgress}}%"></view>
        <!-- æ‹–æ‹½æ‰‹æŸ„ -->
        <view class="progress-thumb {{isDraggingThumb ? 'dragging' : ''}}" 
              style="left: {{currentProgress}}%" 
              catchtouchstart="handleThumbTouchStart"
              catchtouchmove="handleThumbMove"
              catchtouchend="handleThumbEnd">
        </view>
      </view>
    </view>

    <!-- æ’­æ”¾æ§åˆ¶ -->
    <view class="playback-controls">
      <!-- åˆ†äº«æŒ‰é’® -->
      <view class="control-btn" bindtap="handleShare">
        <image src="{{cdnImages.shareIcon}}" alt="åˆ†äº«" class="icon"></image>
      </view>

      <!-- åé€€15ç§’ -->
      <view class="control-btn" bindtap="handleRewind">
        <image src="{{cdnImages.rewindIcon}}" alt="åé€€15ç§’" class="icon"></image>
      </view>

      <!-- æ’­æ”¾/æš‚åœæŒ‰é’® -->
      <view class="play-pause-btn" bindtap="handlePlayPause">
        <image src="{{isPlaying ? cdnImages.pauseIcon : cdnImages.playIcon}}" 
               alt="{{isPlaying ? 'æš‚åœ' : 'æ’­æ”¾'}}" class="play-pause-icon"></image>
      </view>

      <!-- å‰è¿›30ç§’ -->
      <view class="control-btn" bindtap="handleFastForward">
        <image src="{{cdnImages.forwardIcon}}" alt="å‰è¿›30ç§’" class="icon"></image>
      </view>

      <!-- è®¤çŸ¥æå–æŒ‰é’® -->
      <view class="control-btn" bindtap="handleInsight">
        <image src="{{cdnImages.insightIcon}}" alt="è®¤çŸ¥æå–" class="icon"></image>
      </view>
    </view>

    <!-- æ›´å¤šæ“ä½œæŒ‰é’® -->
    <view class="more-actions">
      <view class="more-btn" bindtap="handleMore">
        <text>â‹¯</text>
      </view>
    </view>
    </swiper-item>
    </swiper>
  </view>

  <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{loading}}" class="loading-indicator">
    <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å½“æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºçš„å†…å®¹ -->
  <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
    <text>æš‚æ— æ’­å®¢å†…å®¹</text>
  </view>

  <!-- è‡ªå®šä¹‰éŸ³é¢‘åŠ è½½æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
    <view class="loading-overlay"></view>
    <view class="loading-content">
      <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="åŠ è½½ä¸­"></image>
      <text class="loading-text">{{audioLoadingText}}</text>
    </view>
  </view>

  <!-- è®¤çŸ¥æå–å¼¹çª— -->
  <view wx:if="{{insightVisible}}" class="insight-popup {{insightFullScreen ? 'fullscreen' : ''}}" 
        catchtouchmove="preventScroll">
    <!-- é®ç½©å±‚ -->
    <view class="insight-mask" bindtap="handleInsightClose"></view>
    
    <!-- å¼¹çª—å†…å®¹å®¹å™¨ -->
    <view class="insight-container {{insightFullScreen ? 'fullscreen' : ''}}" 
          catchtouchmove="preventScroll">
      
      <!-- æ‹–æ‹½æŒ‡ç¤ºæ¡å’Œå¤´éƒ¨ - è´Ÿè´£å…¨å±åˆ‡æ¢æ‰‹åŠ¿ -->
      <view class="insight-header"
            catchtouchstart="handleDragStart"
            catchtouchmove="handleDragMove"
            catchtouchend="handleDragEnd">
        <view class="drag-indicator"></view>
        <view class="insight-title-bar">
          <text class="insight-title">è®¤çŸ¥æå–</text>
          <view class="close-btn-wrapper">
            <view class="close-btn" data-action="close" catchtap="handleInsightClose">
              <text>Ã—</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ - è´Ÿè´£å…³é—­æ‰‹åŠ¿ -->
      <scroll-view class="insight-content" 
                   scroll-y="{{true}}"
                   catchtouchstart="handleContentTouchStart"
                   catchtouchmove="handleContentTouchMove" 
                   catchtouchend="handleContentTouchEnd">
        <!-- å†…å®¹åŒ…è£…å®¹å™¨ -->
        <view class="insight-content-wrapper">
        <!-- æ’­å®¢åŸºæœ¬ä¿¡æ¯ -->
        <view class="insight-podcast-info">
          <text class="podcast-title-insight">{{podcastList[currentIndex].title}}</text>
          <text class="podcast-channel-insight">{{podcastList[currentIndex].channel_name || 'å¥‡ç»©å‰æ²¿ä¿¡å·'}}</text>
        </view>
        
        <!-- Insightå†…å®¹åŒºåŸŸ -->
        <view wx:if="{{currentInsightData}}" class="insight-main-content">
          <!-- æ ¸å¿ƒæ€»ç»“ -->
          <view class="insight-section">
            <view class="section-title">
              <text class="title-icon">ğŸ’¡</text>
              <text class="title-text">æ ¸å¿ƒæ´å¯Ÿ</text>
            </view>
            <view class="summary-content">
              <text class="summary-text">{{currentInsightData.summary}}</text>
            </view>
          </view>
          
          <!-- è¯¦ç»†å†…å®¹ -->
          <view wx:if="{{currentInsightData.detailed_content}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">ğŸ“„</text>
              <text class="title-text">è¯¦ç»†åˆ†æ</text>
            </view>
            <view class="detailed-content">
              <text class="detailed-text">{{currentInsightData.detailed_content}}</text>
            </view>
          </view>
          
          <!-- å…³é”®è¯æ ‡ç­¾ -->
          <view wx:if="{{currentInsightData.keywords && currentInsightData.keywords.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">ğŸ·ï¸</text>
              <text class="title-text">å…³é”®è¯</text>
            </view>
            <view class="keywords-container">
              <view wx:for="{{currentInsightData.keywords}}" wx:key="*this" class="keyword-tag">
                <text class="keyword-text">{{item}}</text>
              </view>
            </view>
          </view>
          
          <!-- ç›¸å…³è®ºæ–‡ -->
          <view wx:if="{{currentInsightData.related_papers && currentInsightData.related_papers.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">ğŸ“š</text>
              <text class="title-text">ç›¸å…³è®ºæ–‡</text>
            </view>
            <view class="related-papers">
              <view wx:for="{{currentInsightData.related_papers}}" wx:key="title" class="paper-item">
                <text class="paper-title">{{item.title}}</text>
                <text class="paper-authors">{{item.authors.join(', ')}}</text>
              </view>
            </view>
          </view>
          
          <!-- ç›¸å…³ä½œè€… -->
          <view wx:if="{{currentInsightData.related_authors && currentInsightData.related_authors.length > 0}}" class="insight-section">
            <view class="section-title">
              <text class="title-icon">ğŸ‘¥</text>
              <text class="title-text">ç›¸å…³ä½œè€…</text>
            </view>
            <view class="related-authors">
              <view wx:for="{{currentInsightData.related_authors}}" wx:key="name" class="author-item">
                <text class="author-name">{{item.name}}</text>
                <text class="author-institution">{{item.institution}}</text>
              </view>
            </view>
          </view>
          
          <!-- äº’åŠ¨åŒºåŸŸ -->
          <view class="insight-actions">
            <view class="action-item" bindtap="handleInsightLike">
              <image src="{{currentInsightData.isLiked ? cdnImages.likeActiveIcon : cdnImages.likeIcon}}" 
                     class="action-icon-image" alt="ç‚¹èµ"></image>
              <text class="action-count">{{currentInsightData.like_count || 0}}</text>
            </view>
            <view class="action-item" bindtap="handleInsightBookmark">
              <image src="{{cdnImages.favoriteIcon}}" class="action-icon-image" alt="æ”¶è—"></image>
              <text class="action-text">æ”¶è—</text>
            </view>
            <view class="action-item" bindtap="handleInsightShare">
              <image src="{{cdnImages.shareGrayIcon}}" class="action-icon-image" alt="åˆ†äº«"></image>
              <text class="action-text">åˆ†äº«</text>
            </view>
          </view>
        </view>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{insightLoading}}" class="insight-loading">
          <image src="{{cdnImages.loadingIcon}}" class="loading-icon-small"></image>
          <text class="loading-text-small">æ­£åœ¨åŠ è½½è®¤çŸ¥æå–...</text>
        </view>
        
        <!-- é”™è¯¯çŠ¶æ€ -->
        <view wx:if="{{insightError}}" class="insight-error">
          <text class="error-icon">âš ï¸</text>
          <text class="error-text">{{insightError}}</text>
          <view class="retry-btn" bindtap="handleInsightRetry">
            <text>é‡è¯•</text>
          </view>
        </view>
        </view> <!-- ç»“æŸ insight-content-wrapper -->
      </scroll-view>
    </view>
  </view>
</view>