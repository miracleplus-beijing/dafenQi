<!-- æ¼«æ¸¸é¡µé¢ - ç®€çº¦åšå®¢ç¾å­¦é‡è®¾è®¡ -->
<view class="browse-page">

  <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}"
          class="podcast-loader">
      <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="åŠ è½½ä¸­"></image>
  </view>
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view wx:if="{{!loading && podcastList.length > 0}}">
    <swiper class="browse-swiper"
            vertical="true"
            indicator-dots="false"
            autoplay="{{false}}"
            interval="999999"
            circular="false"
            current="{{currentIndex}}"
            duration="300"
            easing-function="easeInOutCubic"
            bindchange="handleSwiperChange"
            bindtouchstart="handleTouchStart"
            bindtouchmove="handleTouchMove">

      <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">

        <!-- å†…å®¹å±•ç¤ºåŒºåŸŸ (60%) -->
        <view class="content-display">

          <!-- æ’­å®¢å°é¢ -->
          <view class="podcast-cover {{index === currentIndex && isPlaying ? 'playing' : ''}}">

            <view class="cover-image-container">
              <image wx:if="{{item.cover_url}}"
                     src="{{item.cover_url}}"
                     class="cover-image"
                     mode="aspectFill"
                     alt="{{item.title}}" />
              <view wx:else class="cover-placeholder">
                <view class="cover-icon">ğŸµ</view>
                <view class="cover-title">{{item.title}}</view>
              </view>

              <!-- æš‚åœé®ç½©æ•ˆæœ -->
              <view wx:if="{{index === currentIndex && !isPlaying}}" class="pause-overlay" >
                <t-icon name="play" size="128rpx" class="pause-icon" />
              </view>
            </view>
            <view class="podcast-card">
            åšå®¢è„šæœ¬å ä½ç¬¦
            </view>

   

  

          </view>

          <!-- æ ‡é¢˜åŒºåŸŸ -->
          <view class="title-section">
            <text class="main-title">{{item.title}}</text>
            <text class="sub-title">{{item.channel_name || 'è¾¾èŠ¬Qiè¯´'}}</text>
          </view>

          <!-- æ¨ªå‘æ“ä½œæ  -->
          <view class="horizontal-actions">
            <view class="horizontal-action-btn {{item.isFavorited ? 'favorited' : ''}}" bindtap="handleFavorite">
              <image src="{{item.isFavorited ? 'https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/collection_selected.svg' : 'https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/collection_unselected.svg'}}"
                     class="horizontal-action-icon" />
            </view>

            <view class="horizontal-action-btn" bindtap="handleOpenComments">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/comment_quote.svg"
                     class="horizontal-action-icon" />
            </view>

            <view class="horizontal-action-btn">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/share.svg"
                     class="horizontal-action-icon" />
            </view>
          </view>

          <!-- å†…å®¹æ‘˜è¦åŒºåŸŸ (æ›¿ä»£è®¤çŸ¥å¡ç‰‡) -->
          <view class="content-summary">
            <view class="summary-label">
              <text>å†…å®¹æ‘˜è¦</text>
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/insight.svg"
                     class="summary-icon" />
            </view>
            <text class="summary-text">{{item.description || 'è¿™æ˜¯ä¸€æœŸç²¾å½©çš„æ’­å®¢å†…å®¹ï¼ŒåŒ…å«äº†ä¸°å¯Œçš„çŸ¥è¯†ç‚¹å’Œæ·±åº¦æ€è€ƒã€‚'}}</text>
          </view>
        </view>

        <!-- æ’­æ”¾æ§åˆ¶åŒºåŸŸ (40%) -->
        <view class="playback-section">

          <!-- è¿›åº¦æ§åˆ¶ -->
          <view class="progress-section">
            <view class="time-info">
              <text class="current-time">{{currentTimeFormatted}}</text>
              <text class="total-time">{{totalTimeFormatted}}</text>
            </view>

            <view class="progress-container">
              <t-slider
                value="{{currentProgress}}"
                min="{{0}}"
                max="{{100}}"
                step="{{0.1}}"
                theme="filled"
                color="#ed8936"
                track-color="#e2e8f0"
                class="custom-slider"
                bindchange="handleSliderChange"
                bindchanging="handleSliderChanging"
                bindtouchstart="handleSliderTouchStart"
                bindtouchend="handleSliderTouchEnd"
                show-value="{{false}}"
              />
            </view>
          </view>

          <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
          <view class="playback-controls">
            <!-- æ’­æ”¾é€Ÿåº¦ -->
            <view class="control-btn" bindtap="handleSpeedChange">
              <text class="speed-display">{{playbackSpeed}}Ã—</text>
            </view>

            <!-- åé€€15ç§’ -->
            <view class="control-btn" bindtap="handleRewind">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/backward-15s.svg"
                     class="control-icon" />
            </view>
            <!-- æ’­æ”¾/æš‚åœæŒ‰é’® -->
            <view class="play-btn" bindtap="handlePlayPause">

              <t-icon wx:if="{{ isPlaying }}" size="80rpx" name="pause" class="play-icon"  data-name="pause" bind:click="onIconTap" />
              <t-icon wx:else name="play" size="80rpx" class="play-icon"  data-name="play" bind:click="onIconTap" />

            </view>

            <!-- å‰è¿›30ç§’ -->
            <view class="control-btn" bindtap="handleFastForward">
              <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/forward-30s.svg"
                     class="control-icon" />

            </view>

            <!-- æ›´å¤šæ“ä½œ -->
            <view class="control-btn" bindtap="handleMore">
              <text class="more-icon">â‹¯</text>
            </view>
          </view>
        </view>

      </swiper-item>
    </swiper>
  </view>

  <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{loading}}" class="loading-indicator">
    <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å½“æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºçš„å†…å®¹ -->
  <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
    <text>æš‚æ— æ’­å®¢å†…å®¹</text>
  </view>

  <!-- è‡ªå®šä¹‰éŸ³é¢‘åŠ è½½æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
    <view class="loading-overlay"></view>
    <view class="loading-content">
      <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="åŠ è½½ä¸­"></image>
      <text class="loading-text">{{audioLoadingText}}</text>
    </view>
  </view>

  <!-- è¯„è®ºå¼¹çª— -->
  <view class="comment-popup {{showCommentPopup ? 'show' : ''}}" catchtouchmove="preventScroll">
    <view class="popup-mask" bindtap="handleCloseComments"></view>
    <view class="popup-content">
      <view class="popup-header">
        <text class="popup-title">è¯„è®º</text>
        <view class="popup-close" bindtap="handleCloseComments">
          <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/close.svg"
                 class="close-icon" />
        </view>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <scroll-view class="comment-list" scroll-y>
        <view wx:for="{{commentList}}" wx:key="id" class="comment-item">
          <image src="{{item.user_avatar}}" class="comment-avatar" />
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.user_nickname}}</text>
              <text class="comment-time">{{item.timestamp_formatted}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
            <view class="comment-actions">
              <view class="comment-action-btn" bindtap="handleReplyComment" data-comment-id="{{item.id}}">
                <text>å›å¤</text>
              </view>
              <view class="comment-action-btn like-btn {{item.isLiked ? 'liked' : ''}}"
                    bindtap="handleLikeComment"
                    data-comment-id="{{item.id}}">
                <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/like-small.svg"
                       class="like-icon" />
                <text>{{item.like_count > 0 ? item.like_count : ''}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- ç©ºè¯„è®ºæç¤º -->
        <view wx:if="{{commentList.length === 0}}" class="comment-empty">
          <text>è¿˜æ²¡æœ‰è¯„è®ºï¼Œæ¥æŠ¢æ²™å‘å§~</text>
        </view>
      </scroll-view>

      <!-- è¯„è®ºè¾“å…¥æ¡† -->
      <view class="comment-input-wrapper">
        <input
          class="comment-input"
          placeholder="{{replyingToCommentId ? 'å›å¤è¯„è®º...' : 'å‘è¡¨è¯„è®º...'}}"
          value="{{commentInputText}}"
          bindinput="handleCommentInput"
          confirm-type="send"
          bindconfirm="handleSendComment" />
        <view class="send-btn {{commentInputText.length > 0 ? 'active' : ''}}" bindtap="handleSendComment">
          <text>å‘é€</text>
        </view>
      </view>
    </view>
  </view>

  <t-toast id="t-toast" />

</view>

