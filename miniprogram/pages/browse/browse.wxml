<view>
    <!-- Êº´Ê∏∏È°µÈù¢ - Èü≥‰πêÊí≠ÊîæÂô®È£éÊ†ºËÆæËÆ° -->
    <view class="browse-page">

        <!-- SwiperÊ®°Âºè -->
        <view wx:if="{{browseMode === 'swiper'}}" class="swiper-mode">
            <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
            <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}"
                  class="podcast-loader">
                <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="Âä†ËΩΩ‰∏≠"></image>
            </view>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
            <view wx:if="{{!loading && podcastList.length > 0}}">
                <swiper class="browse-swiper"
                        vertical="true"
                        indicator-dots="{{false}}"
                        autoplay="{{false}}"
                        interval="999999"
                        circular="false"
                        current="{{currentIndex}}"
                        duration="300"
                        easing-function="easeInOutCubic"
                        bindchange="handleSwiperChange"
                >

                    <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">

                        <!-- ÂÜÖÂÆπÂ±ïÁ§∫Âå∫Âüü -->
                        <view class="content-display">

                            <!-- ÂúÜÂΩ¢Êí≠ÂÆ¢Â∞ÅÈù¢ + ÂÖâÊôïÊïàÊûú -->
                            <view class="podcast-cover-wrapper">
                                <!-- ÂÖâÊôïËÉåÊôØ -->
                                <view class="cover-glow {{index === currentIndex && isPlaying ? 'playing' : ''}}"></view>

                                <!-- ÂúÜÂΩ¢Â∞ÅÈù¢ÂÆπÂô® -->
                                <view class="podcast-cover-circle {{index === currentIndex && isPlaying ? 'rotating' : ''}}"
                                      bindtap="handlePlayPause">
                                    <image wx:if="{{item.cover_url}}"
                                           src="{{item.cover_url}}"
                                           class="cover-image-circle"
                                           mode="aspectFill"
                                           alt="{{item.title}}"/>
                                    <view wx:else class="cover-placeholder-circle">
                                        <view class="cover-icon">üéµ</view>
                                    </view>

                                    <!-- Êí≠Êîæ/ÊöÇÂÅúÊåâÈíÆË¶ÜÁõñÂ±Ç -->
                                    <view class="play-overlay-circle {{index === currentIndex && isPlaying ? 'hidden' : ''}}">
                                        <t-icon name="play" size="80rpx" color="#ffffff" class="play-icon-overlay"/>
                                    </view>
                                </view>
                            </view>

                            <!-- Ê†áÈ¢òÂå∫Âüü -->
                            <view class="title-section">
                                <text class="main-title">{{item.title}}</text>
                                <text class="sub-title">{{item.channel_name || 'Â•áÁª©ÂâçÊ≤ø‰ø°Âè∑'}}</text>
                            </view>

                            <!-- ÂÜÖÂÆπÊëòË¶Å - ‰∏ÄË°åÂ∞èÂ≠ó -->
                            <view class="content-summary-line" bindtap="handleEnterReadingMode">
                                <text class="summary-text-line">{{item.description || 'ËøôÊòØ‰∏ÄÊúüÁ≤æÂΩ©ÁöÑÊí≠ÂÆ¢ÂÜÖÂÆπÔºåÂåÖÂê´‰∫Ü‰∏∞ÂØåÁöÑÁü•ËØÜÁÇπÂíåÊ∑±Â∫¶ÊÄùËÄÉ„ÄÇ'}}</text>
                            </view>
                        </view>

                        <!-- Êí≠ÊîæÊéßÂà∂Âå∫Âüü -->
                        <view class="playback-section">

                            <!-- ÈüµÂæãÊ≥¢ÂΩ¢ËøõÂ∫¶Êù° -->
                            <view class="waveform-progress-section">
                                <!-- Ê≥¢ÂΩ¢ÂèØËßÜÂåñÂå∫Âüü -->
                                <view class="waveform-container"
                                      bindtouchstart="handleWaveformTouchStart"
                                      bindtouchmove="handleWaveformTouchMove"
                                      bindtouchend="handleWaveformTouchEnd"
                                      data-podcast-id="{{item.id}}">
                                    <!-- Ê≥¢ÂΩ¢Êù° -->
                                    <view class="waveform-bars">
                                        <view wx:for="{{waveformBars}}"
                                              wx:for-item="bar"
                                              wx:for-index="barIndex"
                                              wx:key="barIndex"
                                              class="waveform-bar {{barIndex < (item.playState.progress / 100 * waveformBars.length) ? 'played' : 'unplayed'}}"
                                              style="height: {{bar.height}}rpx;">
                                        </view>
                                    </view>
                                    <!-- ÊãñÂä®ÊªëÂùó - Á´ñÁä∂ÂÖâÊ†Ö -->
                                    <view class="waveform-thumb {{isDraggingWaveform ? 'dragging' : ''}}"
                                          style="left: {{item.playState.progress}}%;">
                                    </view>
                                </view>

                                <!-- Êó∂Èó¥ÊòæÁ§∫ -->
                                <view class="time-info-waveform">
                                    <text class="current-time">{{item.playState.currentTimeFormatted}}</text>
                                    <!-- <t-icon name="sound" size="32rpx" color="#1a365d" class="sound-icon"/> -->
                                    <text class="total-time">{{item.playState.totalTimeFormatted}}</text>
                                </view>
                            </view>

                            <!-- Â∫ïÈÉ®Êìç‰ΩúÊåâÈíÆ -->
                            <view class="bottom-actions">
                                <!-- ËØÑËÆ∫ -->
                                <view class="action-btn" bindtap="handleOpenComments">
                                    <t-icon name="chat" size="48rpx" color="#718096"/>
                                </view>

                                <!-- ÂàÜ‰∫´ -->
                                <button class="action-btn share-btn" open-type="share">
                                    <t-icon name="share" size="48rpx" color="#718096"/>
                                </button>

                                <!-- Êõ¥Â§öÊìç‰Ωú -->
                                <view class="action-btn" bindtap="handleMore">
                                    <t-icon name="ellipsis" size="48rpx" color="#718096"/>
                                </view>

                                <!-- Êî∂ËóèÊåâÈíÆ -->
                                <view class="action-btn" bindtap="handleFavorite">
                                    <t-icon
                                        name="{{podcastList[currentIndex].isFavorited ? 'heart-filled' : 'heart'}}"
                                        size="48rpx"
                                        color="{{podcastList[currentIndex].isFavorited ? '#ed8936' : '#718096'}}"/>
                                </view>
                            </view>
                        </view>

                    </swiper-item>
                </swiper>
            </view>
        </view>

        <!-- ÁÄëÂ∏ÉÊµÅÊ®°ÂºèÔºàÂ∞ÅË£Ö‰∏∫ÂÆπÂô®ÁªÑ‰ª∂Ôºâ -->
        <view wx:if="{{browseMode === 'waterfall'}}" class="waterfall-mode">
            <waterfall-container bind:play="handleWaterfallPlay"/>
        </view>

        <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
        <view wx:if="{{loading}}" class="loading-indicator">
            <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
            <text>Âä†ËΩΩ‰∏≠...</text>
        </view>

        <!-- ÂΩìÊ≤°ÊúâÊï∞ÊçÆÊó∂ÊòæÁ§∫ÁöÑÂÜÖÂÆπ -->
        <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
            <text>ÊöÇÊó†Êí≠ÂÆ¢ÂÜÖÂÆπ</text>
        </view>

        <!-- Ëá™ÂÆö‰πâÈü≥È¢ëÂä†ËΩΩÊåáÁ§∫Âô® -->
        <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
            <view class="loading-overlay"></view>
            <view class="loading-content">
                <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="Âä†ËΩΩ‰∏≠"></image>
                <text class="loading-text">{{audioLoadingText}}</text>
            </view>
        </view>

        <!-- Êõ¥Â§öÊìç‰ΩúÂºπÁ™ó -->
        <view class="more-popup {{showMorePopup ? 'show' : ''}}" catchtouchmove="preventScroll">
            <view class="popup-mask" bindtap="handleCloseMorePopup"></view>
            <view class="popup-content more-popup-content">
                <view class="popup-header">
                    <text class="popup-title">Êõ¥Â§öÊìç‰Ωú</text>
                    <view class="popup-close" bindtap="handleCloseMorePopup">
                        <t-icon name="close" size="48rpx" class="close-icon"/>
                    </view>
                </view>

                <!-- Êìç‰ΩúÈÄâÈ°πÂàóË°® -->
                <view class="more-actions-list">
                    <!-- Êí≠ÊîæÂÄçÈÄü -->
                    <view class="more-action-item" bindtap="handleSpeedChange">
                        <t-icon name="time" size="48rpx" color="#718096" class="action-icon"/>
                        <text class="action-text">ÂÄçÈÄü {{playbackSpeed}}√ó</text>
                    </view>

                    <!-- ‰∏ãËΩΩÊìç‰Ωú -->
                    <view class="more-action-item" bindtap="handleDownload">
                        <t-icon name="download" size="48rpx" color="#718096" class="action-icon"/>
                        <text class="action-text">‰∏ãËΩΩ</text>
                    </view>
                </view>
            </view>
        </view>

        <!-- ËØÑËÆ∫ÂºπÁ™óÁªÑ‰ª∂ -->
        <comment-popup
                visible="{{showCommentPopup}}"
                comment-list="{{commentList}}"
                comment-input-text="{{commentInputText}}"
                replying-to-comment-id="{{replyingToCommentId}}"
                bind:close="handleCloseComments"
                bind:input="handleCommentInput"
                bind:send="handleSendComment"
                bind:reply="handleReplyComment"
                bind:like="handleLikeComment"
        />

    </view>

    <!-- ÈòÖËØªÊ®°ÂºèÈÅÆÁΩ©Â±Ç -->
    <view wx:if="{{isReadingMode}}" class="reading-mode-overlay {{readingModeExpanded ? 'active' : ''}}"
          catchtouchmove="preventScroll">
        <!-- È°∂ÈÉ®Êìç‰ΩúÊ†è -->
        <view class="reading-header">
            <view class="reading-close-btn" bindtap="handleExitReadingMode">
                <t-icon name="close" size="48rpx" color="#2d3748"/>
            </view>
            <view class="reading-share-btn" bindtap="handleShare">
                <t-icon name="share" size="44rpx" color="#718096"/>
            </view>
        </view>

        <!-- ÂÜÖÂÆπÊªöÂä®Âå∫Âüü -->
        <scroll-view
                class="reading-content-scroll"
                scroll-y="true"
                enable-back-to-top="true"
                scroll-with-animation="true">
            <view class="reading-content-wrapper">
                <text class="reading-title">{{podcastList[currentIndex].title}}</text>
                <text class="reading-text">{{podcastList[currentIndex].description || 'ÊöÇÊó†ÂÜÖÂÆπÊëòË¶Å'}}</text>
            </view>
        </scroll-view>

        <!-- ÁÆÄÂåñÊí≠ÊîæÊéßÂà∂Ê†è -->
        <view class="reading-playback-bar">
            <!-- Êí≠ÂÆ¢‰ø°ÊÅØ -->
            <view class="reading-podcast-info">
                <image
                        src="{{podcastList[currentIndex].cover_url}}"
                        class="reading-mini-cover"
                        mode="aspectFill"/>
                <view class="reading-podcast-text">
                    <text class="reading-podcast-title">{{podcastList[currentIndex].title}}</text>
                    <text class="reading-podcast-channel">{{podcastList[currentIndex].channel_name}}</text>
                </view>
            </view>

            <!-- ËøõÂ∫¶Êù° -->
            <view class="reading-progress-container">
                <t-slider
                        value="{{podcastList[currentIndex].playState.progress}}"
                        min="{{0}}"
                        max="{{100}}"
                        step="{{0.1}}"
                        theme="filled"
                        color="#ed8936"
                        track-color="#e2e8f0"
                        class="reading-slider"
                        bind:change="handleSliderChange"
                        bind:dragstart="handleSliderTouchStart"
                        bind:dragend="handleSliderTouchEnd"
                        show-value="{{false}}"
                />
            </view>

            <!-- Êí≠ÊîæÊéßÂà∂ÊåâÈíÆ -->
            <view class="reading-controls">
                <view class="reading-control-btn" bindtap="handleRewind">
                    <t-icon name="backward" size="44rpx" color="#718096"/>
                </view>

                <view class="reading-play-btn" bindtap="handlePlayPause">
                    <t-icon
                            wx:if="{{isPlaying}}"
                            size="80rpx"
                            class="control-icon"
                            name="pause"/>
                    <t-icon
                            wx:else
                            size="80rpx"
                            class="control-icon"
                            name="play"/>
                </view>

                <view class="reading-control-btn" bindtap="handleFastForward">
                    <t-icon name="forward" size="44rpx" color="#718096"/>
                </view>
            </view>
        </view>
    </view>

    <!-- ÂÖ®Â±ÄËø∑‰Ω†Êí≠ÊîæÂô® -->
    <mini-player
            wx:if="{{browseMode !== 'swiper' && globalPlayer.isVisible}}"
            current-podcast="{{globalPlayer.currentPodcast}}"
            is-playing="{{globalPlayer.isPlaying}}"
            current-progress="{{globalPlayer.currentProgress}}"
            is-visible="{{globalPlayer.isVisible}}"
            safe-area-bottom="{{safeAreaBottom}}"
            bind:playpause="handleGlobalPlayerPlayPause"
            bind:expand="handleGlobalPlayerExpand"
            bind:close="handleGlobalPlayerClose"/>

    <t-toast id="t-toast"/>

</view>
