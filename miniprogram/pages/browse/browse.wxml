<view>
    <!-- Êº´Ê∏∏È°µÈù¢ - ÂèåÊ®°ÂºèËÆæËÆ° -->
    <view class="browse-page">

        <!-- SwiperÊ®°Âºè -->
        <view wx:if="{{browseMode === 'swiper'}}" class="swiper-mode">
            <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
            <view wx:if="{{index === currentIndex && isPlaying && audioLoading}}"
                  class="podcast-loader">
                <image src="{{cdnImages.loadingIcon}}" class="loader-icon" alt="Âä†ËΩΩ‰∏≠"></image>
            </view>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
            <view wx:if="{{!loading && podcastList.length > 0}}">
                <swiper class="browse-swiper"
                        vertical="true"
                        indicator-dots="{{false}}"
                        autoplay="{{false}}"
                        interval="999999"
                        circular="false"
                        current="{{currentIndex}}"
                        duration="300"
                        easing-function="easeInOutCubic"
                        bindchange="handleSwiperChange"
                >

                    <swiper-item wx:for="{{podcastList}}" wx:key="id" class="browse-container">

                        <!-- ÂÜÖÂÆπÂ±ïÁ§∫Âå∫Âüü (60%) -->
                        <view class="content-display">

                            <!-- Êí≠ÂÆ¢Â∞ÅÈù¢ -->
                            <view class="podcast-cover {{index === currentIndex && isPlaying ? 'playing' : ''}}">

                                <view class="cover-image-container">
                                    <image wx:if="{{item.cover_url}}"
                                           src="{{item.cover_url}}"
                                           class="cover-image"
                                           mode="aspectFill"
                                           alt="{{item.title}}"/>
                                    <view wx:else class="cover-placeholder">
                                        <view class="cover-icon">üéµ</view>
                                        <view class="cover-title">{{item.title}}</view>
                                    </view>

                                    <!-- ÊöÇÂÅúÈÅÆÁΩ©ÊïàÊûú -->
                                    <view wx:if="{{index === currentIndex && !isPlaying}}" class="pause-overlay">
                                        <t-icon name="play" size="128rpx" class="pause-icon"/>
                                    </view>
                                </view>
                            </view>

                            <!-- Ê†áÈ¢òÂå∫Âüü -->
                            <view class="title-section">
                                <text class="main-title">{{item.title}}</text>
                                <text class="sub-title">{{item.channel_name || 'Â•áÁª©ÂâçÊ≤ø‰ø°Âè∑'}}</text>
                            </view>

                            <!-- ÂÜÖÂÆπÊëòË¶ÅÂå∫Âüü (Êõø‰ª£ËÆ§Áü•Âç°Áâá) -->
                            <view class="content-summary" bindtap="handleEnterReadingMode">
                                <view class="summary-label">
                                    <text>ÂÜÖÂÆπÊëòË¶Å</text>
                                    <t-icon name="bulb" size="32rpx" color="#ed8936" class="summary-icon"/>
                                </view>
                                <text class="summary-text">{{item.description || 'ËøôÊòØ‰∏ÄÊúüÁ≤æÂΩ©ÁöÑÊí≠ÂÆ¢ÂÜÖÂÆπÔºåÂåÖÂê´‰∫Ü‰∏∞ÂØåÁöÑÁü•ËØÜÁÇπÂíåÊ∑±Â∫¶ÊÄùËÄÉ„ÄÇ'}}</text>
                            </view>
                        </view>

                        <!-- Êí≠ÊîæÊéßÂà∂Âå∫Âüü (40%) -->
                        <view class="playback-section">

                            <!-- ËøõÂ∫¶ÊéßÂà∂ -->
                            <view class="progress-section">
                                <view class="time-info">
                                    <text class="current-time">{{item.playState.currentTimeFormatted}}</text>
                                    <text class="total-time">{{item.playState.totalTimeFormatted}}</text>
                                </view>

                                <view class="progress-container">
                                    <t-slider
                                            value="{{item.playState.progress}}"
                                            min="{{0}}"
                                            max="{{100}}"
                                            step="{{0.1}}"
                                            theme="filled"
                                            color="#ed8936"
                                            track-color="#e2e8f0"
                                            class="custom-slider"
                                            bind:change="handleSliderChange"
                                            bind:dragstart="handleSliderTouchStart"
                                            bind:dragend="handleSliderTouchEnd"
                                            show-value="{{false}}"
                                    />
                                </view>
                            </view>

                            <!-- Êí≠ÊîæÊéßÂà∂ÊåâÈíÆ -->
                            <view class="playback-controls">
                                <!-- Êí≠ÊîæÈÄüÂ∫¶ -->
                                <view class="control-btn" bindtap="handleSpeedChange">
                                    <text class="speed-display">{{playbackSpeed}}√ó</text>
                                </view>

                                <!-- ÂêéÈÄÄ15Áßí -->
                                <view class="control-btn" bindtap="handleRewind">
                                    <t-icon name="backward" size="60rpx" class="control-icon"/>
                                </view>
                                <!-- Êí≠Êîæ/ÊöÇÂÅúÊåâÈíÆ -->
                                <view class="play-btn" bindtap="handlePlayPause">

                                    <t-icon wx:if="{{ index === currentIndex && isPlaying }}" size="80rpx" name="pause"
                                            class="play-icon" data-name="pause" bind:click="onIconTap"/>
                                    <t-icon wx:else name="play" size="80rpx" class="play-icon" data-name="play"
                                            bind:click="onIconTap"/>

                                </view>

                                <!-- ÂâçËøõ15Áßí -->
                                <view class="control-btn" bindtap="handleFastForward">
                                    <t-icon name="forward" size="60rpx" class="control-icon"/>
                                </view>

                                <!-- Êõ¥Â§öÊìç‰Ωú -->
                                <view class="control-btn" bindtap="handleMore">
                                    <text class="more-icon">‚ãØ</text>
                                </view>
                            </view>
                        </view>

                    </swiper-item>
                </swiper>
            </view>
        </view>

        <!-- ÁÄëÂ∏ÉÊµÅÊ®°ÂºèÔºàÂ∞ÅË£Ö‰∏∫ÂÆπÂô®ÁªÑ‰ª∂Ôºâ -->
        <view wx:hidden="{{browseMode === 'waterfall'}}" class="waterfall-mode">
            <waterfall-container bind:play="handleWaterfallPlay"/>
        </view>

        <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
        <view wx:if="{{loading}}" class="loading-indicator">
            <image src="{{cdnImages.loadingIcon}}" class="loading-icon"></image>
            <text>Âä†ËΩΩ‰∏≠...</text>
        </view>

        <!-- ÂΩìÊ≤°ÊúâÊï∞ÊçÆÊó∂ÊòæÁ§∫ÁöÑÂÜÖÂÆπ -->
        <view wx:if="{{!loading && podcastList.length === 0}}" class="no-data-indicator">
            <text>ÊöÇÊó†Êí≠ÂÆ¢ÂÜÖÂÆπ</text>
        </view>

        <!-- Ëá™ÂÆö‰πâÈü≥È¢ëÂä†ËΩΩÊåáÁ§∫Âô® -->
        <view wx:if="{{audioLoadingVisible}}" class="custom-audio-loading">
            <view class="loading-overlay"></view>
            <view class="loading-content">
                <image src="{{cdnImages.loadingIcon}}" class="custom-loading-icon" alt="Âä†ËΩΩ‰∏≠"></image>
                <text class="loading-text">{{audioLoadingText}}</text>
            </view>
        </view>

        <!-- Êõ¥Â§öÊìç‰ΩúÂºπÁ™ó -->
        <view class="more-popup {{showMorePopup ? 'show' : ''}}" catchtouchmove="preventScroll">
            <view class="popup-mask" bindtap="handleCloseMorePopup"></view>
            <view class="popup-content more-popup-content">
                <view class="popup-header">
                    <text class="popup-title">Êõ¥Â§öÊìç‰Ωú</text>
                    <view class="popup-close" bindtap="handleCloseMorePopup">
                        <t-icon name="close" size="48rpx" class="close-icon"/>
                    </view>
                </view>

                <!-- Êìç‰ΩúÈÄâÈ°πÂàóË°® -->
                <view class="more-actions-list">
                    <!-- Êî∂ËóèÊìç‰Ωú -->
                    <view class="more-action-item" bindtap="handleFavorite">
                        <t-icon name="{{podcastList[currentIndex].isFavorited ? 'heart-filled' : 'heart'}}"
                                size="48rpx"
                                color="{{podcastList[currentIndex].isFavorited ? '#ed8936' : '#718096'}}"
                                class="action-icon"/>
                        <text class="action-text">{{podcastList[currentIndex].isFavorited ? 'ÂèñÊ∂àÊî∂Ëóè' : 'Êî∂Ëóè'}}</text>
                    </view>

                    <!-- ËØÑËÆ∫Êìç‰Ωú -->
                    <view class="more-action-item" bindtap="handleOpenComments">
                        <t-icon name="chat" size="48rpx" color="#718096" class="action-icon"/>
                        <text class="action-text">ËØÑËÆ∫</text>
                    </view>

                    <!-- ÂàÜ‰∫´Êìç‰Ωú -->
                    <view class="more-action-item" bindtap="handleShare">
                        <t-icon name="share" size="48rpx" color="#718096" class="action-icon"/>
                        <text class="action-text">ÂàÜ‰∫´</text>
                    </view>

                    <!-- ‰∏ãËΩΩÊìç‰Ωú -->
                    <view class="more-action-item" bindtap="handleDownload">
                        <t-icon name="download" size="48rpx" color="#718096" class="action-icon"/>
                        <text class="action-text">‰∏ãËΩΩ</text>
                    </view>
                </view>
            </view>
        </view>

        <!-- ËØÑËÆ∫ÂºπÁ™óÁªÑ‰ª∂ -->
        <comment-popup
                visible="{{showCommentPopup}}"
                comment-list="{{commentList}}"
                comment-input-text="{{commentInputText}}"
                replying-to-comment-id="{{replyingToCommentId}}"
                bind:close="handleCloseComments"
                bind:input="handleCommentInput"
                bind:send="handleSendComment"
                bind:reply="handleReplyComment"
                bind:like="handleLikeComment"
        />

    </view>

    <!-- ÈòÖËØªÊ®°ÂºèÈÅÆÁΩ©Â±Ç -->
    <view wx:if="{{isReadingMode}}" class="reading-mode-overlay {{readingModeExpanded ? 'active' : ''}}"
          catchtouchmove="preventScroll">
        <!-- È°∂ÈÉ®Êìç‰ΩúÊ†è -->
        <view class="reading-header">
            <view class="reading-close-btn" bindtap="handleExitReadingMode">
                <t-icon name="close" size="48rpx" color="#2d3748"/>
            </view>
            <view class="reading-share-btn" bindtap="handleShare">
                <t-icon name="share" size="44rpx" color="#718096"/>
            </view>
        </view>

        <!-- ÂÜÖÂÆπÊªöÂä®Âå∫Âüü -->
        <scroll-view
                class="reading-content-scroll"
                scroll-y="true"
                enable-back-to-top="true"
                scroll-with-animation="true">
            <view class="reading-content-wrapper">
                <text class="reading-title">{{podcastList[currentIndex].title}}</text>
                <text class="reading-text">{{podcastList[currentIndex].description || 'ÊöÇÊó†ÂÜÖÂÆπÊëòË¶Å'}}</text>
            </view>
        </scroll-view>

        <!-- ÁÆÄÂåñÊí≠ÊîæÊéßÂà∂Ê†è -->
        <view class="reading-playback-bar">
            <!-- Êí≠ÂÆ¢‰ø°ÊÅØ -->
            <view class="reading-podcast-info">
                <image
                        src="{{podcastList[currentIndex].cover_url}}"
                        class="reading-mini-cover"
                        mode="aspectFill"/>
                <view class="reading-podcast-text">
                    <text class="reading-podcast-title">{{podcastList[currentIndex].title}}</text>
                    <text class="reading-podcast-channel">{{podcastList[currentIndex].channel_name}}</text>
                </view>
            </view>

            <!-- ËøõÂ∫¶Êù° -->
            <view class="reading-progress-container">
                <t-slider
                        value="{{podcastList[currentIndex].playState.progress}}"
                        min="{{0}}"
                        max="{{100}}"
                        step="{{0.1}}"
                        theme="filled"
                        color="#ed8936"
                        track-color="#e2e8f0"
                        class="reading-slider"
                        bind:change="handleSliderChange"
                        bind:dragstart="handleSliderTouchStart"
                        bind:dragend="handleSliderTouchEnd"
                        show-value="{{false}}"
                />
            </view>

            <!-- Êí≠ÊîæÊéßÂà∂ÊåâÈíÆ -->
            <view class="reading-controls">
                <view class="reading-control-btn" bindtap="handleRewind">
                    <t-icon name="backward" size="44rpx" color="#718096"/>
                </view>

                <view class="reading-play-btn" bindtap="handlePlayPause">
                    <t-icon
                            wx:if="{{isPlaying}}"
                            name="pause"
                            size="56rpx"
                            color="#ffffff"/>
                    <t-icon
                            wx:else
                            name="play"
                            size="56rpx"
                            color="#ffffff"/>
                </view>

                <view class="reading-control-btn" bindtap="handleFastForward">
                    <t-icon name="forward" size="44rpx" color="#718096"/>
                </view>
            </view>
        </view>
    </view>

    <!-- ÂÖ®Â±ÄËø∑‰Ω†Êí≠ÊîæÂô® -->
    <mini-player
            wx:if="{{browseMode !== 'swiper' && globalPlayer.isVisible}}"
            current-podcast="{{globalPlayer.currentPodcast}}"
            is-playing="{{globalPlayer.isPlaying}}"
            current-progress="{{globalPlayer.currentProgress}}"
            is-visible="{{globalPlayer.isVisible}}"
            safe-area-bottom="{{safeAreaBottom}}"
            bind:playpause="handleGlobalPlayerPlayPause"
            bind:expand="handleGlobalPlayerExpand"
            bind:close="handleGlobalPlayerClose"/>

    <t-toast id="t-toast"/>

</view>

