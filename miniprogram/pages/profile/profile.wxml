<!-- 我的页面 - Frosted Paper Theme -->
<view class="profile-container"
      bindtouchstart="touchStart"
      bindtouchmove="touchMove"
      bindtouchend="touchEnd">

  <!-- 全局纹理背景 -->
  <view class="bg-paper-pattern"></view>

  <!-- 背景装饰光斑 (Blue Theme) -->
  <view class="bg-decoration-blob blob-1"></view>
  <view class="bg-decoration-blob blob-2"></view>

  <!-- ================= 1. 已登录状态 (Logged In) ================= -->
  <view class="logged-in-view" wx:if="{{isLoggedIn}}">

    <!-- 用户信息卡片 -->
    <view class="user-card frosted-paper">
      <!-- 装饰性背景光 -->
      <view class="card-decoration-light"></view>

      <!-- 头像 -->
      <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <view class="avatar-border">
          <image
            class="user-avatar"
            src="{{userInfo.avatarUrl || 'https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/user.svg'}}"
            mode="aspectFill"
          />
        </view>
        <!-- 编辑提示 -->
        <view class="avatar-edit-hint">
          <t-icon name="edit" size="32rpx" />
        </view>
      </button>

      <!-- 用户名/ID -->
      <view class="user-info-section">
        <text class="user-name font-serif-display" bindtap="changeUserName">{{userInfo.nickName || 'Alpha Sight 用户'}}</text>
        <view class="user-id-badge" wx:if="{{userInfo.id}}">
          <text class="user-id-text">ID: {{userInfo.id}}</text>
        </view>
      </view>
    </view>

    <!-- 菜单区域 1: 我的内容 -->
    <view class="menu-section">
      <text class="section-title font-serif-display">我的内容</text>

      <view class="menu-group frosted-paper">
        <!-- 收听历史 -->
        <view class="menu-item" bindtap="handleMenuClick" data-type="history">
          <view class="menu-icon-wrapper blue">
            <t-icon name="time" size="40rpx" />
          </view>
          <text class="menu-label">收听历史</text>
          <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
        </view>

        <!-- 我的收藏 -->
        <view class="menu-item" bindtap="handleMenuClick" data-type="favorites">
          <view class="menu-icon-wrapper red">
            <t-icon name="heart" size="40rpx" />
          </view>
          <text class="menu-label">我的收藏</text>
          <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
        </view>

        <!-- 我的评论 -->
        <view class="menu-item menu-item-last" bindtap="handleMenuClick" data-type="comments">
          <view class="menu-icon-wrapper green">
            <t-icon name="chat" size="40rpx" />
          </view>
          <text class="menu-label">我的评论</text>
          <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
        </view>
      </view>
    </view>

    <!-- 菜单区域 2: 更多 -->
    <view class="menu-section">
      <text class="section-title font-serif-display">更多</text>

      <view class="menu-group frosted-paper">
        <!-- 设置 -->
        <view class="menu-item" bindtap="handleMenuClick" data-type="settings">
          <view class="menu-icon-wrapper gray">
            <t-icon name="setting" size="40rpx" />
          </view>
          <text class="menu-label">设置</text>
          <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
        </view>

        <!-- 退出登录 -->
        <view class="menu-item menu-item-last" bindtap="handleLogout">
          <view class="menu-icon-wrapper orange">
            <t-icon name="logout" size="40rpx" />
          </view>
          <text class="menu-label logout-text">退出登录</text>
          <t-icon name="chevron-right" size="40rpx" class="menu-arrow" />
        </view>
      </view>
    </view>

  </view>

  <!-- ================= 2. 未登录状态 (Logged Out) ================= -->
  <view class="login-view" wx:if="{{!isLoggedIn}}">

    <view class="login-card login-card-glass">
      <!-- 装饰光效 -->
      <view class="login-decoration-gradient"></view>
      <view class="login-decoration-blob login-blob-1"></view>
      <view class="login-decoration-blob login-blob-2"></view>

      <!-- Hero Icon -->
      <view class="login-icon-wrapper">
        <t-icon name="user" size="80rpx" />
      </view>

      <!-- Title -->
      <text class="login-title font-serif-display">欢迎使用达芬Qi说</text>
      <text class="login-subtitle">登录后享受完整功能</text>

      <!-- Features List -->
      <view class="login-features">
        <view class="feature-item">
          <view class="feature-icon">
            <t-icon name="check-circle-filled" size="32rpx" />
          </view>
          <text class="feature-text">同步收藏和历史</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">
            <t-icon name="check-circle-filled" size="32rpx" />
          </view>
          <text class="feature-text">个性化推荐内容</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">
            <t-icon name="check-circle-filled" size="32rpx" />
          </view>
          <text class="feature-text">跨设备数据同步</text>
        </view>
      </view>

      <!-- Login Button -->
      <button class="login-button" bindtap="handleLogin">
        <text>立即登录</text>
      </button>
    </view>

  </view>

  <!-- 手势反馈 (浮动玻璃胶囊) -->
  <view class="gesture-feedback" wx:if="{{showSwipeIndicator}}">
    <view class="gesture-pill frosted-paper {{swipeDirection === 'right' ? 'active' : ''}}">
      <text class="gesture-text">Category</text>
      <t-icon name="chevron-right" class="gesture-icon" />
    </view>
  </view>

</view>
