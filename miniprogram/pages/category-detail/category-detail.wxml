<!-- åˆ†ç±»è¯¦æƒ…é¡µé¢ - ç£¨ç ‚çº¸è´¨æ„Ÿè®¾è®¡ -->
<view class="category-detail-container">
  <!-- çº¸å¼ çº¹ç†èƒŒæ™¯ -->
  <view class="bg-paper-pattern"></view>

  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration-1"></view>
  <view class="bg-decoration-2"></view>

  <!-- æ’åºèœå•é®ç½© -->
  <view wx:if="{{showSortMenu}}" class="sort-mask" bindtap="closeSortMenu"></view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <t-loading theme="circular" size="48px" />
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:else class="content-wrapper">
  

    <!-- æ’åºèœå• -->
    <view wx:if="{{showSortMenu}}" class="sort-menu frosted-paper" catchtap="stopPropagation">
      <view class="sort-menu-title">æ’åºæ–¹å¼</view>
      <view class="sort-options">
        <view
          wx:for="{{sortByOptions}}"
          wx:key="value"
          class="sort-option {{ sortBy === item.value ? 'active' : '' }}"
          bindtap="onSortChange"
          data-value="{{item.value}}"
        >
          <text class="option-label">{{ item.label }}</text>
          <view wx:if="{{sortBy === item.value}}" class="option-check">
            <t-icon name="check" size="16px" color="#0884FF" />
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <view class="main-content" scroll-y enable-back-to-top lower-threshold="50" bindscrolltolower="onReachBottom">
      <!-- åˆ†ç±»ä¿¡æ¯ Hero åŒºåŸŸ -->
      <view class="category-hero">
        <!-- åŠ¨æ€æ¸å˜èƒŒæ™¯ -->
        <view
          class="hero-gradient"
          style="background: linear-gradient(135deg, {{category && category.color && category.color[0] ? category.color[0] : '#e0f2fe'}} 0%, {{category && category.color && category.color[1] ? category.color[1] : '#0ea5e9'}} 100%)"
        ></view>
        <!-- ç£¨ç ‚çº¹ç†å åŠ  -->
        <view class="hero-texture"></view>

        <!-- å†…å®¹å±‚ -->
        <view class="hero-content-layer">
          <view class="hero-badge">CATEGORY</view>
          <view class="hero-title">{{ category.displayName || categoryName }}</view>
          <view class="hero-footer">
            <view class="hero-subtitle">{{ category.name || 'æ¢ç´¢æ— é™å¯èƒ½' }}</view>
            <view class="hero-stats-badge">
              <text class="stats-number">{{ podcasts.length }}</text>
              <text class="stats-label">Episodes</text>
            </view>
          </view>
        </view>

        <!-- è£…é¥°å›¾æ ‡ -->
        <view class="hero-decoration-icon">ğŸ”¬</view>
      </view>

      <!-- æ’­å®¢åˆ—è¡¨ä¸ºç©º -->
      <view wx:if="{{podcasts.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ“­</view>
        <view class="empty-text">è¯¥åˆ†ç±»æš‚æ— æ’­å®¢å†…å®¹</view>
        <view class="empty-hint">è¯·ç¨åå†æ¥æŸ¥çœ‹</view>
      </view>

      <!-- æ’­å®¢åˆ—è¡¨ -->
      <view wx:else class="podcasts-list">
        <view
          wx:for="{{podcasts}}"
          wx:key="id"
          class="podcast-item-card"
          bindtap="playPodcast"
          data-item="{{item}}"
        >
          <!-- å°é¢ -->
          <view class="podcast-cover-wrapper">
            <image
              src="{{item.cover_url}}"
              mode="aspectFill"
              class="podcast-cover-img"
            />
            <view class="duration-badge-new">{{item.duration || 0}}m</view>
            <!-- æ’­æ”¾é®ç½© -->
            <view class="play-overlay">
              <view class="play-button">
                <t-icon name="play" size="12px" color="#0884FF" />
              </view>
            </view>
          </view>

          <!-- ä¿¡æ¯ -->
          <view class="podcast-info-wrapper">
            <view class="podcast-title-new">{{ item.title }}</view>
            <view class="podcast-channel-new">
              {{ item.channels && item.channels.name ? item.channels.name : (item.channel && item.channel.name ? item.channel.name : 'æœªçŸ¥é¢‘é“') }}
              <text wx:if="{{item.channels && item.channels.name}}"> â€¢ Ep. {{ item.id.slice(-2) }}</text>
            </view>

            <!-- Meta Info -->
            <view class="podcast-meta-new">
              <view class="meta-item-new">
                <t-icon name="play-circle" size="10px" />
                <text>{{ item.play_count || 0 }}</text>
              </view>
              <view class="meta-item-new">
                <t-icon name="heart" size="10px" />
                <text>{{ item.favorite_count || 0 }}</text>
              </view>
              <view class="meta-item-new meta-date">
                <text>{{ item.created_at && item.created_at.indexOf ? item.created_at.split('T')[0] : 'æœªçŸ¥æ—¥æœŸ' }}</text>
              </view>
            </view>
          </view>

          <!-- Action -->
          <view class="podcast-action-new">
            <t-icon name="chevron-right" size="20px" color="#E0E0E0" />
          </view>
        </view>

        <!-- åŠ è½½æ›´å¤šæç¤º -->
        <view wx:if="{{loadingMore}}" class="loading-more-new">
          <view class="loading-dot"></view>
          <view class="loading-dot"></view>
          <view class="loading-dot"></view>
          <text class="loading-more-text">Loading more...</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤šæ•°æ®æç¤º -->
        <view wx:if="{{!hasMoreData && podcasts.length > 0}}" class="no-more-new">
          <text>å·²åŠ è½½å…¨éƒ¨å†…å®¹</text>
        </view>
      </view>

      <!-- åº•éƒ¨å ä½ -->
      <view class="bottom-spacer"></view>
    </view>
  </view>

  <!-- åˆ†äº«æµ®åŠ¨æŒ‰é’® -->
  <button
    class="share-floating-btn"
    wx:if="{{!loading && podcasts.length > 0}}"
    open-type="share"
  >
    <t-icon name="share" size="24px" color="#0884FF" />
  </button>
</view>
