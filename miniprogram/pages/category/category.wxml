<!-- 分类页面 - iOS 风格重设计 -->
<view class="category-container">
  <!-- 搜索区域 -->
  <view class="search-section">
    <view class="search-bar" bindtap="goToSearch">
      <t-icon name="{{icons.search}}" class="search-icon" />
      <text class="search-placeholder">听你想听的论文</text>
    </view>
  </view>

  <!-- 学术分类 - 横向滚动两行布局 -->
  <view class="academic-section">
    <view class="section-header">
      <text class="section-title">学术领域</text>
      <text class="section-subtitle">向右滑动查看更多</text>
    </view>

    <scroll-view wx:if="{{!loading.categories}}" class="categories-scroll" scroll-x enable-flex>
      <view class="categories-grid">
        <!-- 第一行 -->
        <view class="category-row">
          <view wx:for="{{academicCategories}}" wx:key="id" wx:if="{{index < 4}}"
                class="category-card category-card-{{index + 1}}"
                bindtap="selectCategory"
                data-category="{{item}}">
            <view class="category-content">
              <text class="category-title">{{item.displayName}}</text>
            </view>
          </view>
        </view>
        <!-- 第二行 -->
        <view class="category-row">
          <view wx:for="{{academicCategories}}" wx:key="id" wx:if="{{index >= 4}}"
                class="category-card category-card-{{index + 1}}"
                bindtap="selectCategory"
                data-category="{{item}}">
            <view class="category-content">
              <text class="category-title">{{item.displayName}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- 分类加载状态 - 骨架屏 -->
    <view wx:if="{{loading.categories}}" class="categories-scroll">
      <view class="categories-grid">
        <view class="category-row">
          <view wx:for="{{[1,2,3,4]}}" wx:key="index" class="skeleton-card">
            <view class="skeleton skeleton-full"></view>
          </view>
        </view>
        <view class="category-row">
          <view wx:for="{{[1,2,3]}}" wx:key="index" class="skeleton-card">
            <view class="skeleton skeleton-full"></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 精选推荐区域 -->
  <view class="featured-section">
    <view class="section-header">
      <text class="section-title">编辑精选</text>
      <view class="refresh-btn" bindtap="refreshContent">
        <t-icon name="refresh" class="refresh-icon" />
        <text>换一换</text>
      </view>
    </view>

    <view wx:if="{{!loading.featured}}" class="featured-content">
      <view wx:for="{{featuredContent}}" wx:key="id" class="featured-card">
        <view class="featured-cover">
          <image src="{{item.podcast.cover_url}}"
                 class="cover-image"
                 mode="aspectFill"
                 lazy-load="{{lazyLoadEnabled}}" />
          <view class="play-overlay" bindtap="playPodcast" data-item="{{item.podcast}}">
            <t-icon name="play" class="play-icon" />
          </view>
        </view>
        <view class="featured-info">
          <text class="featured-title">{{item.podcast.title}}</text>
          <text class="featured-description">{{item.recommendationText}}</text>
          <view class="featured-meta">
            <text class="channel-name">{{item.podcast.channels.name}}</text>
            <text class="duration">{{item.podcast.duration || "时长未知"}}</text>
          </view>
        </view>
      </view>

      <!-- 如果没有精选内容 -->
      <view wx:if="{{featuredContent.length === 0}}" class="empty-placeholder">
        <t-icon name="help-circle" class="empty-icon" />
        <text>暂无精选内容</text>
      </view>
    </view>

    <!-- 精选加载状态 - 骨架屏 -->
    <view wx:if="{{loading.featured}}" class="featured-content">
      <view wx:for="{{[1,2,3]}}" wx:key="index" class="skeleton-featured">
        <view class="skeleton skeleton-cover"></view>
        <view class="skeleton-info">
          <view class="skeleton skeleton-line long"></view>
          <view class="skeleton skeleton-line medium"></view>
          <view class="skeleton skeleton-line short"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 排行榜区域 - Tab切换 -->
  <view class="rankings-section">
    <view class="section-header">
      <text class="section-title">排行榜</text>
    </view>

    <view wx:if="{{!loading.rankings}}" class="rankings-content">
      <!-- Tab栏 -->
      <t-tabs value="{{currentRankingTab}}" bind:change="onRankingTabChange" theme="tag" space-evenly="{{false}}">
        <t-tab-panel label="最热" value="hot"></t-tab-panel>
        <t-tab-panel label="最新" value="new"></t-tab-panel>
        <t-tab-panel label="综述" value="review"></t-tab-panel>
      </t-tabs>

      <!-- 榜单列表 -->
      <view class="ranking-list">
        <view wx:for="{{rankings[currentRankingTab]}}" wx:for-index="idx" wx:key="id"
              class="ranking-item"
              bindtap="playPodcast"
              data-item="{{item}}">
          <text class="rank-number">{{idx + 1}}</text>
          <view class="rank-content">
            <text class="rank-title">{{item.title}}</text>
            <text class="rank-play-count">{{item.play_count}}次播放</text>
          </view>
          <t-icon name="play-circle" class="rank-play-icon" />
        </view>
      </view>

      <!-- 查看完整榜单按钮 -->
      <view class="view-full-ranking-btn" bindtap="viewFullRanking">
        <text>查看完整榜单</text>
      </view>
    </view>

    <!-- 排行榜加载状态 - 骨架屏 -->
    <view wx:if="{{loading.rankings}}" class="rankings-content">
      <view class="skeleton skeleton-line long" style="margin-bottom: 16px;"></view>
      <view wx:for="{{[1,2,3]}}" wx:key="index" style="margin-bottom: 12px;">
        <view class="skeleton skeleton-line medium"></view>
      </view>
    </view>
  </view>

  <!-- 底部区域 -->
  <view class="bottom-loader">
    <image src="https://gxvfcafgnhzjiauukssj.supabase.co/storage/v1/object/public/static-images/icons/loading.svg" class="loader-icon" alt="加载中"></image>
    <view class="loader-text">从源头最大化驱动创新</view>
  </view>

  <!-- 手势反馈指示器 -->
  <view class="gesture-feedback" wx:if="{{showSwipeIndicator}}">
    <view class="swipe-indicator left {{swipeDirection === 'left' ? 'active' : ''}}">
      <t-icon name="chevron-left" class="swipe-icon" />
      <text>个人中心</text>
    </view>
    <view class="swipe-indicator right {{swipeDirection === 'right' ? 'active' : ''}}">
      <text>浏览</text>
      <t-icon name="chevron-right" class="swipe-icon" />
    </view>
  </view>
</view>