# 配置说明

## 1. 微信小程序域名白名单配置

### 在哪里配置？
在**微信公众平台**的小程序管理后台：

1. 🌐 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 📱 进入您的小程序管理后台
3. ⚙️ 左侧菜单：**开发** → **开发管理** → **开发设置**
4. 🔧 找到 **服务器域名** 部分

### 需要配置的域名
将以下域名添加到对应的合法域名列表中：

```
request合法域名：
https://gxvfcafgnhzjiauukssj.supabase.co

uploadFile合法域名：
https://gxvfcafgnhzjiauukssj.supabase.co

downloadFile合法域名：
https://gxvfcafgnhzjiauukssj.supabase.co
```

### 配置步骤截图指南
1. **找到服务器域名设置**
   ```
   开发 → 开发管理 → 开发设置 → 服务器域名
   ```

2. **点击"修改"按钮**

3. **添加域名到对应分类**
   - 在"request合法域名"中添加 Supabase URL
   - 如果需要文件上传下载，也添加到对应分类

4. **保存配置**

⚠️ **注意事项：**
- 域名配置后可能需要几分钟生效
- 开发阶段可以在微信开发者工具中勾选"不校验合法域名"
- 正式发布前必须配置正确的域名白名单

## 2. Supabase配置文件设置

### 配置步骤

1. **复制配置模板**
   ```bash
   # 进入配置目录
   cd miniprogram/config/
   
   # 复制模板文件
   cp supabase.config.example.js supabase.config.js
   ```

2. **获取Supabase配置信息**
   - 登录 [Supabase控制台](https://supabase.com/dashboard)
   - 进入您的项目
   - 点击左侧菜单 **Settings** → **API**
   - 复制以下信息：
     - Project URL
     - anon/public key

3. **更新配置文件**
   编辑 `miniprogram/config/supabase.config.js`：
   ```javascript
   const config = {
     supabaseUrl: 'https://您的项目ID.supabase.co',
     supabaseAnonKey: '您的匿名密钥'
   }
   ```

4. **更新全局配置**
   同时更新 `miniprogram/app.js` 中的配置：
   ```javascript
   globalData: {
     supabaseUrl: 'https://您的项目ID.supabase.co',
     supabaseAnonKey: '您的匿名密钥'
   }
   ```

### 安全说明

✅ **已保护的文件（不会上传到Git）：**
- `.claude/` - Claude Code配置目录
- `miniprogram/config/supabase.config.js` - Supabase密钥配置
- `.env` 文件 - 环境变量
- 其他敏感配置文件

⚠️ **注意事项：**
- `supabase.config.js` 已被 `.gitignore` 保护，不会意外上传
- `supabase.config.example.js` 是模板文件，可以安全上传
- 请勿在代码中硬编码任何密钥

## 3. 项目首次设置清单

### 开发环境设置
- [ ] 克隆项目代码
- [ ] 复制并配置 `supabase.config.js`
- [ ] 在微信开发者工具中打开项目
- [ ] 配置微信小程序域名白名单
- [ ] 测试登录功能

### 生产环境部署
- [ ] 确认所有敏感配置已正确设置
- [ ] 验证域名白名单配置
- [ ] 测试完整的用户登录流程
- [ ] 检查数据库连接和权限
- [ ] 上传代码审核

## 4. 常见问题解决

### Q1: 网络请求失败
**可能原因：**
- 域名白名单未配置
- Supabase URL或密钥错误
- 网络连接问题

**解决方案：**
1. 检查域名白名单配置
2. 验证Supabase配置信息
3. 在开发工具中临时勾选"不校验合法域名"测试

### Q2: 配置文件找不到
**可能原因：**
- 忘记复制 `supabase.config.example.js` 为 `supabase.config.js`

**解决方案：**
```bash
cd miniprogram/config/
cp supabase.config.example.js supabase.config.js
# 然后编辑 supabase.config.js 填入正确配置
```

### Q3: 登录失败
**可能原因：**
- 微信登录权限未开通
- Supabase数据库连接失败
- RLS权限策略问题

**解决方案：**
1. 确认小程序已发布且有登录权限
2. 检查Supabase项目状态
3. 查看数据库日志和错误信息

## 5. 技术支持

如遇到配置问题，可以：
1. 查看控制台错误日志
2. 检查网络请求状态
3. 验证Supabase控制台中的项目状态
4. 参考微信小程序开发文档

---

📝 **提示**: 此文档会随着项目发展持续更新，请定期查看最新版本。